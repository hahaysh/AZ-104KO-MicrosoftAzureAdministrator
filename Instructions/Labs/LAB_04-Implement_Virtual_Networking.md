---
lab:
    title: '04 - 가상 네트워킹 구현'
    module: '모듈 04 - 가상 네트워킹'
---

# 랩 04 - 가상 네트워킹 구현


## 랩 시나리오

Azure 가상 네트워킹 기능을 살펴보십시오. 우선 Azure에 가상 네트워크를 생성하여 Azure 가상 시스템 몇 개를 호스팅할 것입니다. 네트워크 기반 분할을 구현할 예정이므로 가상 네트워크의 다른 서브넷에 배포하십시오. 또한 시간이 지남에 따라 개인 IP 주소와 공용 IP 주소가 변경되지 않도록 하십시오. Contoso 보안 요구 사항을 준수하려면 인터넷에서 액세스할 수 있는 Azure 가상 시스템의 공용 엔드포인트를 보호해야 합니다. 마지막으로 가상 네트워크와 인터넷에서 모두 Azure 가상 시스템에 DNS 이름 확인을 구현해야 합니다.


## 목표

이 과정에서, 우리는 다음과 같은 실습을 합니다 :

+ 작업 1: 가상 네트워크 생성 및 구성
+ 작업 2: 가상 네트워크에 가상 머신 배포
+ 작업 3: Azure 가상 머신의 사설 및 공용 IP 주소 설정
+ 작업 4: 네트워크 보안 그룹 구성
+ 작업 5: 내부 이름 확인을 위한 Azure DNS 구성
+ 작업 6: 외부 이름 확인을 위한 Azure DNS 구성


## 설명

### 작업 1: 가상 네트워크 생성 및 구성

이 작업에서는 Azure 포털을 사용해 다수의 서브넷이 있는 가상 네트워크를 만듭니다.

1. [Azure portal](https://portal.azure.com)에 로그인한다.

1. Azure 포털에서 **가상 네트워크**를 찾아 선택한다. **가상 네트워크** 블레이드에서 **+ 추가**를 클릭한다.

1. 다음 설정을 사용하여 가상 네트워크를 만든다. (다른 값은 기본 설정을 사용한다)

    | 설정 | 값 |
    | --- | --- |
    | 구독 | 이 랩에서 사용할 Azure 구독의 이름 |
    | 리소스 그룹 | 새로만들기 **az104-04-rg1** |
    | 이름 | **az104-04-vnet1** |
    | 지역 | 이 랩에서 사용할 구독에서 이용 가능한 지역의 이름 |
    | IPv4 주소 공간 | **10.40.0.0/20** |
    | 서브넷 이름 | **subnet0** |
    | 서브넷 주소 범위 | **10.40.0.0/24** |

    >**참고:** 가상 네트워크가 프로비전될 때까지 기다리십시오. 이 작업은 1분 미만 소요됩니다.

1. **가상 네트워크** 블레이드에서 **새로 고침**을 하고, **az104-04-vnet1**을 클릭한다.

1. **az104-04-vnet1** 가상 네트워크 블레이드에서 **서브넷**을 선택하고, **+ 서브넷**을 클릭한다. 

1. 다음 설정을 사용하여 서브넷을 만든다. (다른 값은 기본 설정을 사용한다)

    | 설정 | 값 |
    | --- | --- |
    | Name | **subnet1** |
    | 주소 범위 (CIDR 블록) | **10.40.1.0/24** |
    | 네트워크 보안 그룹 | **없음** |
    | 경로 테이블 | **없음** |


### 작업 2:  가상 네트워크에 가상 머신 배포

이 작업에서는 ARM 템플릿을 사용하여 Azure 가상 머신을 가상 네트워크의 다른 서브넷에 배포할 것입니다.

1. Azure 포털에서 오른쪽 위의 이아콘을 클릭하여 **Azure Cloud Shell**을 시작한다. 

1. **Bash** 또는 **PowerShell**을 선택하는 프롬프트 창에서 **PowerShell**을 선택한다.

    >**참고**: **참고**: **Cloud Shell**을 처음 실행한 경우, **탑재된 스토리지가 없음** 메시지가 표시됩니다. 이 랩에서 사용하고 있는 구독을 선택하고 **스토리지 만들기**를 클릭하십시오. 


1. Cloud Shell 창의 툴바에서 **파일 업로드/다운로드** 아이콘을 선택한다. 드롭다운 메뉴에서 **업로드**를 클릭하고, **\\Allfiles\\Labs\\04\\az104-04-vms-template.json** 와 **\\Allfiles\\Labs\\04\\az104-04-vms-parameters.json** 을 Cloud Shell의 홈 디렉토리에 업로드한다. 

    >**참고**: 파일을 각각 업로드 하십시오.

1. Cloud Shell 창에서 다음 명령을 실행하여 업로드한 템플릿과 파라미터 파일을 이용해 두 개의 가상 머신을 배포한다.

   ```powershell
   $rgName = 'az104-04-rg1'

   New-AzResourceGroupDeployment `
      -ResourceGroupName $rgName `
      -TemplateFile $HOME/az104-04-vms-template.json `
      -TemplateParameterFile $HOME/az104-04-vms-parameters.json
   ```

    >**참고**: ARM 템플릿 배포는 Azure PowerShell을 이용합니다. Azure CLI의 **az deployment create** 명령을 이용하여 동일한 작업을 할 수 있습니다. (추가 정보는 [Deploy resources with Resource Manager templates and Azure CLI](https://docs.microsoft.com/en-us/azure/azure-resource-manager/templates/deploy-cli) 를 참고하십시오)

    >**참고**: 다음 단계로 가기 전에 배포가 끝날 때까지 기다리십시오. 이 작업은 약 2분 소요됩니다.

1. Cloud Shell 창을 닫는다. 


### 작업 3: Azure 가상 머신의 사설 및 공용 IP 주소 설정

이 작업에서는 Azure 가상 머신의 네트워크 인터페이스에 사설 및 공용 IP 주소를 정적으로 할당합니다. 

   >**참고**:  개인 및 공용 IP 주소는 실제로 네트워크 인터페이스에 할당되며, 이는 다시 Azure 가상 머신에 연결됩니다. Azure 가상 머신에 할당된 IP 주소를 참조하는 것은 매우 일반적입니다.
   
1. Azure 포털에서 **리소스 그룹**을 검색하고 선택한다. **리소스 그룹** 블레이드에서 **az104-04-rg1**를 클릭한다.

1. **az104-04-rg1** 리소스 그룹 블레이드의 리소스 리스트에서 **az104-04-vnet1**을 클릭한다.

1. **az104-04-vnet1** 가상 네트워크 블레이드의 **연결된 디바이스** 섹션에서 두개의 네트워크 인터페이스 **az104-04-nic0**와 **az104-04-nic1**를 확인한다. 

1. **az104-04-nic0**를 클릭하고, **az104-04-nic0** 블레이드에서 **IP 구성**을 클릭한다. 

    >**참고**: 현재 **ipconfig1**이 동적 IP 주소로 설정되어 있는 것을 확인하십시오.

1. IP 구성 리스트에서 **ipconfig1**을 클릭한다.

1. **ipconfig1** 블레이드에서 **할당**을 **정적**으로 바꾸고, 기본으로 설정된 **IP 주소** 값 **10.40.0.4**을 사용한다.

1. **ipconfig1** 블레이드에서 **공용 IP 주소**를 **연결**로 설정하고 **IP 주소 - 필수 설정 구성**을 클릭한다. 

1. **공용 IP 주소 선택** 블레이드에서 , **+ 새로 만들기**를 클릭하고 다음 설정으로 새로운 공용 IP 주소를 만든다.

    | 설정 | 값 |
    | --- | --- |
    | 이름 | **az104-04-pip0** |
    | SKU | **표준** |

1. **ipconfig1** 블레이드로 돌아가서 변경 사항을 저장한다. 

1. **az104-04-vnet1** 블레이드로 돌아가서 앞선 단계를 반복하여 **az104-04-nic1**의 **ipconfig1** IP 주소를 **정적**으로 바꾸고, **az104-04-nic1**를 새로운 **표준** SKU 공용 IP 주소 **az104-04-pip1**과 연결한다. 

1. **az104-04-rg1** 리소스 그룹 블레이드로 돌아가서 **az104-04-vm0**을 클릭한다. **az104-04-vm0** 가상 머신 블레이드에서 공용 IP 주소를 메모해둔다.

1. **az104-04-rg1** 리소스 그룹 블레이드에서 **az104-04-vm1**을 클릭한다. **az104-04-vm1** 가상 머신 블레이드에서 공용 IP 주소를 메모해둔다. 

    >**참고**: 두 IP 주소를 이 랩의 마지막 단계에 사용할 예정입니다. 


### 작업 4: 네트워크 보안 그룹 구성

이 작업에서는 Azure 가상 머신에 제한된 연결을 허용하기 위헤 네트워크 보안 그룹을 구성할 것입니다. 

1. Azure 포털 **az104-04-rg1** 리소스 그룹 블레이드의 리소스 목록에서 **az104-04-vm0**를 클릭힌다.

1. **az104-04-vm0** 블레이드에서 **연결**을 클릭합니다. 드롭다운 메뉴에서 **RDP**를 선택한다. **RDP를 사용하여 연결** 블레이드에서 **RDP 파일 다운로드**를 클릭하고 원격 데스크톱 세션을 시작한다. 

1. 연결에 실패한 것을 확인한다.

    >**참고**: 이는 표준 SKU의 공용 IP 주소가 기본적으로 할당되는 네트워크 인터페이스는 네트워크 보안 그룹에 의해 보호되어야 하기 때문입니다. 원격 데스크톱 연결을 허용하려면 인터넷에서 인바운드 RDP 트래픽을 명시적으로 허용하는 네트워크 보안 그룹을 생성하고, 이를 두 가상 시스템의 네트워크 인터페이스에 할당하십시오.

1. Azure 포털에서 **네트워크 보안 그룹**을 검색하여 선택한다. **네트워크 보안 그룹** 블레이드에서 **+ 추가**를 클릭한다.

1. 다음 설정을 사용하여 네트워크 보안 그룹을 만든다. (다른 값은 기본 설정을 사용한다)

    | 설정 | 값 |
    | --- | --- |
    | 구독 | 이 랩에서 사용할 Azure 구독의 이름 |
    | 리소스 그룹 | **az104-04-rg1** |
    | 이름 | **az104-04-nsg01** |
    | 지역 | 이 랩에서 다른 모든 리소스가 배포된 지역의 이름 |

    >**참고**: 배포가 완료될 때까지 기다리십시오. 이 작업은 약 2분 소요됩니다.

1. 배포 블레이드에서 **리소스로 이동**울 클릭하고, **az104-04-nsg01** 네트워크 보안 그룹 블레이드로 이동한다. 

1. **az104-04-nsg01** 네트워크 보안 그룹 블레이드에서 **설정** 섹션의  **인바운드 보안 규칙**을 클릭한다.  

1. 다음 설정을 사용하여 인바운드 규칙을 추가한다. (다른 값은 기본 설정을 사용한다)

    | 설정 | 값 |
    | --- | --- |
    | 소스 | **Any** |
    | 원본 포트 범위 | * |
    | 대상 주소 | **Any** |
    | 대상 포트 범위 | **3389** |
    | 프로토콜 | **TCP** |
    | 작업 | **허용** |
    | 우선순위 | **300** |
    | 이름 | **AllowRDPInBound** |

1. **az104-04-nsg01** 네트워크 보안 그룹 블레이드에서 **설정** 섹션의 **네트워크 인터페이스**를 클릭하고 **+ 연결**을 클릭한다.

1. **az104-04-nsg01** 네트워크 보안 그룹을 네트워크 인터페이스 **az104-04-nic0** 와 **az104-04-nic1**에 연결한다.

    >**참고**: 새로 만든 네트워크 보안 그룹을 네트워크 인터페이스 카드에 적용하는 작업은 약 5분 소요됩니다.

1. **az104-04-vm0** 가상 머신 블레이드로 돌아간다.

    >**참고**: 이제 해당 가상 머신에 사용자 이름 **Student**와 패스워드 **Pa55w.rd1234**를 이용해 연결할 수 있습니다.

1. **az104-04-vm0** 블레이드에서 **연결**을 클릭하고, 드롭다운 메뉴에서 **RDP**를 선택한다. **RDP를 사용하여 연결** 블레이드에서 **Download RDP 파일 다운로드**를 클릭하여 원격 데스크톱 세션을 시작한다.  

    >**참고**: 이 단계는 Windows 컴퓨터에서 원격 데스크톱을 통해 연결하는 방법을 설명합니다. Mac 환경에서는 Mac App Store에서 원격 데스크톱 클라이언트를 사용할 수 있으며, Linux 시스템에서는 오픈 소스 RDP 클라이언트 소프트웨어를 사용할 수 있습니다.

    >**참고**: 가상 머신에 연결할 때 나타나는 경고는 무시할 수 있습니다.

1. 연결되면 사용자 이름 **Student**와 **Pa55w.rd1234** 패스워드를 사용하여 로그인합니다. 

    >**참고**: 데스크톱 세션을 그대로 두십시오. 다음 단계에 필요합니다.


### 작업 5: 내부 이름 확인을 위한 Azure DNS 구성

이 작업에서는 Azure 프라이빗 DNS 영역을 이용하여 가상 네트워크 내의 DNS 이름 확인을 구성합니다. 

1. Azure 포털에서  **프라이빗 DNS 영역**을 찾아 선택한다. **프라이빗 DNS 영역** 블레이드에서 **+ 추가**를 클릭한다.

1. 다음 설정을 사용하여 프라이빗 DNS 영역을 구성한다. (다른 값은 기본 설정을 사용한다)

    | 구성 | 값 |
    | --- | --- |
    | 구독 | 이 랩에서 사용할 Azure 구독의 이름 |
    | 리소스 그룹 | **az104-04-rg1** |
    | 이름 | **contoso.org** |

    >**참고**: 프라이빗 DNS 영역이 만들어질 때까지 기다리십시오. 이 작업은 약 2분 소요됩니다.

1. **리소스로 이동**을 클릭해 **contoso.org** 프라이빗 DNS 영역으로 이동한다.

1. **contoso.org** 프라이빗 DNS 영역 블레이드에서 **설정** 섹션의 **가상 네트워크 링크**를 클릭한다.

1. 다음 설정을 사용하여 가상 네트워크 링크를 추가한다. (다른 값은 기본 설정을 사용한다)

    | 구성 | 값 |
    | --- | --- |
    | 링크 이름 | **az104-04-vnet1-link** |
    | 구독 | 이 랩에서 사용할 Azure 구독의 이름 |
    | 가상 네트워크 | **az104-04-vnet1** |
    | 자동 등록 사용 | 사용 |

    >**참고:** 가상 네트워크 링크가 생성될 때까지 기다리십시오. 이 작업은 1분 미만 소요됩니다. 

1. **contoso.org** 프라이빗 DNS 영역의 **개요**를 클릭한다.

1. **az104-04-vm0** 과 **az104-04-vm1**에 대한 DNS 레코드가 **자동 등록됨**으로 나타나는 것을 확인한다.

    >**참고:** 레코드 집합 목록이 나타나지 않으면 몇 분 기다려야 합니다. 

1. **az104-04-vm0** 원격 데스크톱 세션으로 돌아가서 **시작** 버튼을 마우스 우클릭 하고, 메뉴에서 **Windows PowerShell (Admin)**을 선택한다.

1. Windows PowerShell 콘솔 창에 다음 명령을 입력해, 새로 만든 프라이빗 DNS 영역에서 **az104-04-vm1** DNS 레코드 집합의 내부 이름 확인을 테스트 한다.

   ```powershell
   nslookup az104-04-vm1.contoso.org
   ```
1. 실행 명령의 결과가 **az104-04-vm1**의 사설 IP를 포함하고 있음을 확인한다. (**10.40.1.4**)


### 작업 6: 외부 이름 확인을 위한 Azure DNS 구성

이 작업에서는 공용 DNS 영역을 이용하여 외부 DNS 이름 확인을 구성합니다.

1. Azure 포털에서 **DNS 영역**을 찾아 선택하고, **DNS 영역** 블레이드에서 **+ 추가**를 클릭한다.

1. 다음 설정을 사용하여 DNS 영역을 구성한다. (다른 값은 기본 설정을 사용한다)

    | 설정 | 값 |
    | --- | --- |
    | 구독 | 이 랩에서 사용하고 있는 Azure 구독의 이름 |
    | 리소스 그룹 | **az104-04-rg1** |
    | 이름 | 고유한 이름 |

    >**참고**: DNS 영역이 만들어질 때까지 기다리십시오. 이 작업은 약 2분 소요됩니다. 

1. **리소스로 이동**을 클릭하여 DNS 영역 블레이드로 이동한다. 

1. DNS 영역 블레이드에서 **+ 레코드 집합**을 클릭한다.

1. 다음 설정을 사용해 레코드 집합을 구성한다. (다른 값은 기본 설정을 사용한다)

    | 설정 | 값 |
    | --- | --- |
    | 이름 | **az104-04-vm0** |
    | 유형 | **A** |
    | 별칭 레코드 집합 | **아니요** |
    | TTL | **1** |
    | TTL 단위 | **시간** |
    | IP 주소 | 이 랩의 세 번째 연습에서 확인했던 **az104-04-vm0**의 공용 IP 주소 |

1. 다음 설정을 사용해 레코드 집합을 구성한다. (다른 값은 기본 설정을 사용한다)

    | 설정 | 값 |
    | --- | --- |
    | 이름 | **az104-04-vm1** |
    | 유형 | **A** |
    | 별칭 레코드 집합 | **아니요** |
    | TTL | **1** |
    | TTL 단위 | **시간** |
    | IP 주소 | 이 랩의 세 번째 연습에서 확인했던 **az104-04-vm1**의 공용 IP 주소 |

1. DNS 영역 블레이드에서 **이름 서버 1** 엔트리를 복사한다.

1. Azure 포털에서 오른쪽 위의 아이콘을 클릭하여 **Cloud Shell**의 **PowerShell** 세션을 시작한다.

1. Cloud Shell 창에서 다음 명령을 실행하여 **az104-04-vm0** DNS 레코드 집합의 외부 이름 확인을 테스트한다.
(`[Name server 1]`을 이전 작업에서 복사한 **이름 서버 1**로 대체한다, `[contoso.org]`를 이전 작업에서 지정한 이름으로 대체한다)

   ```powershell
   nslookup az104-04-vm0.[contoso.org] [Name server 1]
   ```
1. 명령 결과가 **az104-04-vm0**의 공용 IP를 포함하는 것을 확인한다.

1. Cloud Shell 창에서 다음 명령을 실행하여 **az104-04-vm1** DNS 레코드 집합의 외부 이름 확인을 테스트한다.
(`[Name server 1]`을 이전 작업에서 복사한 **이름 서버 1**로 대체한다, `[contoso.org]`를 이전 작업에서 지정한 이름으로 대체한다)

   ```powershell
   nslookup az104-04-vm1.[contoso.org] [Name server 1]
   ```
1. 명령 결과가 **az104-04-vm1**의 공용 IP를 포함하는 것을 확인한다.


### 리소스 삭제

   >**참고**: 사용하지 않는 새로 생성된 Azure 리소스를 제거하십시오. 사용하지 않는 리소스를 제거해야 예상치 못한 비용이 발생하지 않습니다.

1. Azure 포털에서 **Cloud Shell**의 **PowerShell** 세션을 시작한다. 

1. 다음 명령을 실행하여 이 모듈의 실습에서 생성된 모든 리소스 그룹을 나열한다.

   ```powershell
   Get-AzResourceGroup -Name 'az104-04*'
   ```

1. 다음 명령을 실행하여 이 모듈의 실습에서 생성한 모든 리소스 그룹을 삭제한다.

   ```powershell
   Get-AzResourceGroup -Name 'az104-04*' | Remove-AzResourceGroup -Force -AsJob
   ```

    >**참고**: 이 명령은 비동기적으로 실행되므로( --nowait 매개 변수로 결정됨) 동일한 Bash 세션 내에서 즉시 다른 Azure CLI 명령을 실행할 수 있지만, 리소스 그룹이 실제로 제거되기까지는 몇 분 정도 소요됩니다.


### 요약

이 랩에서 우리는

- 가상 네트워크를 만들고 구성했습니다.
- 가상 머신을 가상 네트워크에 배포했습니다.
- Azure 가상 머신의 사설 및 공용 IP를 구성했습니다.
- 네트워크 보안 그룹을 구성했습니다.
- 내부 이름 확인을 위한 Azure DNS를 구성했습니다.
- 외부 이름 확인을 위한 Azure DNS를 구성했습니다. 
